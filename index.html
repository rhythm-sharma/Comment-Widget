<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Comment-Widget</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css"/>
    <script src="jquery.js"></script>
    <!-- <script src="main.js" ></script>  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body onload="show_div();">

<!----------------------------------------- Heading --------------------------------->

    <header class="header">
    <div style="margin: 0 0 0 1em" class="top-heading"><h3>Comments</h3><img style="vertical-align:bottom;min-height:28px;max-height:28px;min-width:28px;max-width:28px;" src="src/img/chat.svg" alt="comment-img"></div>
    <div style=" width:auto;background-color: rgba(192, 171, 171, 0.2);box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);" class="login-div">
        <img style="background-color:white;border-radius:50%;" class="img" src="https://robohash.org/345" alt="photo">
        <p style="margin-left:15px; margin-right:5px;" id="fetch-username-after-login">guest</p>
    </div>
    </header>
    <hr style="display: block;height: 1px;border: 0;border-top: 1px solid #ccc;margin:1em 0 0 1em;padding: 0px;">

<!----------------------------------------- Sample - comment    --------------------------------->
    <div id="comment-boxes">    
            <div id="comment-box-id" class="comment-box-class">
                <div class="photo">
                <img class="img" src="https://robohash.org/ssdf" alt="photo">
            </div>
            <div class="information">
                <div class="row1">
                    <div class="name"><strong class="comment-name-class" id="fetch-name">Rhythm</strong></div>
                    <div class="time_ago" id="fetch-time">5 min ago</div>
                </div>
                <div class="row2" class="comment-message-class" id="fetch-message">
                    <!-- <textarea id="comments" class="input-field" style="height:100%;width :200%;" name="comment" placeholder="Enter your comment here..."></textarea> -->
                    This has been very useful for my research. Thanks as well! mmkkmkopd sfkopsdkopsdkops dkcvopskvop s kvpodfckv dpflvklpvlp cvklopcvkcov kpxcovk xpcokv; xockv bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
                </div>
                <div class="row3">
                    <div class="reply"><button id="r" class="reply" style="text-decoration:none;border:none;" class="button">Reply</button></div>
                    <div class="vote">
                        <div id="fetch-like">  
                            <i id="a" class="fa fa-thumbs-up like fetch-like-count"  onclick="like(this.id);">0</i>
                        </div>
                        <div id="fetch-dislike">
                            <i id="b" class="fa fa-thumbs-down dislike fetch-dislike-count" onclick="dislike(this.id);">0</i>
                        </div>
                    </div>
                </div>
            </div>
            </div>
    </div>

<!----------------------------------------- Comment-box for guest --------------------------------->


    <div id="new-message" class="new-message">
        <div class="message-box">
            <textarea id="comments" class="input-field" name="comment" onclick="document.getElementById('modal-wrapper').style.display='block'" placeholder="Enter your comment here..."></textarea>
        </div>
        <div class="submit-button">
            <button onclick="document.getElementById('modal-wrapper').style.display='block'" style="width: 8rem;margin-top:1em;margin-left:2em;" class="btn" class="button_other">Add a Comment</button>
        </div>
    </div>

<!-----------------------------------------  Login-form  --------------------------------->

<div id="modal-wrapper" class="modal">
      
        <form onsubmit="return false;" class="modal-content animate">
            <div class="imgcontainer">
                <span onclick="document.getElementById('modal-wrapper').style.display='none'" class="close" title="Close PopUp">&times;</span>
                <img src="https://robohash.org/196.png" alt="Avatar" class="avatar">
                <h1 style="text-align:center">Login</h1>
            </div>
    
            <div class="container">
                <input id="log-usr" autocomplete="off" type="text" placeholder="Enter Username" name="uname" required>
                <input id="log-psw" autocomplete="off" type="password" placeholder="Enter Password" name="psw" required>        
                <button class="button_other" type="submit" onclick="login();">Login</button>
                <button onclick="document.getElementById('modal-wrapper-2').style.display='block';document.getElementById('modal-wrapper').style.display='none'" class="button button_other">Sign Up</button>         
            </div>
        </form>
    </div>


<!-----------------------------------------  signup-form  --------------------------------->

    
    <div id="modal-wrapper-2" class="modal">
      
        <form onsubmit="return false;" class="modal-content animate">
            <div class="imgcontainer">
                <span onclick="document.getElementById('modal-wrapper-2').style.display='none'" class="close" title="Close PopUp">&times;</span>
                <img src="https://robohash.org/196.png" alt="Avatar" class="avatar">
                <h1 style="text-align:center">Sign Up here</h1>
            </div>
    
            <div class="container">
                <input id="sign-usr" autocomplete="off" type="text" placeholder="Enter Username" name="uname" required>
                <input id="sign-psw" autocomplete="off" type="password" placeholder="Enter Password" name="psw" required>        
                <button class="button_other" type="submit">Sign Up</button>
            </div>
        </form>
    </div>

<!----------------------------------------- Something after signup -------------------------->


    <!-------------------------------  message box popup open after login ----------------------------->

    <div id="message-box-popup" class="modal">
            <form onsubmit="return false;" class="modal-content animate">
                <div class="imgcontainer" style="margin-top:0px;">
                    <span style="  position: absolute;top: 0px;right: 0px;" onclick="document.getElementById('message-box-popup').style.display='none'" class="close" title="Close PopUp">&times;</span>
                </div>
                <h3>Enter your comment here</h3>
                <div class="container" style="margin-top:20px;">
                    <textarea autocomplete="off" style="width:90%" id="message-box-comments" class="input-field" name="comment" onclick="" placeholder="Enter your comment here..."></textarea>
                    <button onclick="Add_comment();" style="width: 8rem;margin-left:2em;margin-top:1em;" class="btn">Add a comment</button>  
                </div>
            </form>
        </div> 

<script>    

let member;
let comment_message;
let comment_boxes = document.getElementById("comment-boxes");
var wrapper = document.createElement('div');

// let mylist = [];
// localStorage['mylist'] = JSON.stringify(mylist);
// var mylist = JSON.parse(localStorage['mylist']);


function store_btn_click(){
if(typeof(Storage) !== "undefined") {
        if (localStorage.clickcount) {
            localStorage.clickcount = Number(localStorage.clickcount)+1;
        }else{
            localStorage.clickcount = 1;
        }
    }
}


function last_login_member(member){
    localStorage.setItem('last_login_member', member);
}


function show_div(){

//*********************************   showing save comments *****************************//    
    if(localStorage != null){
        for(var i=1, len=localStorage.length; i<=len; i++) {
            for(var j=1, len=localStorage.length; j<=len; j++) {
                var key = localStorage.key(j-1);
                var value = localStorage[key];
                if(key == `div ${i}`){
                    var d1 = document.getElementById('comment-boxes');
                    d1.insertAdjacentHTML('beforeend', value);
                }
            }
        }


//*********************************   showing login member name on top-right corner *****************************//    
    if(localStorage['last_login_member'] != null)
        document.getElementById('fetch-username-after-login').innerHTML = localStorage['last_login_member'];
    }

//*********************************   showing likes and dislikes after reload*****************************//    
    for( let m = 1; m<=localStorage.clickcount; m++){
            document.getElementById(m).innerHTML = localStorage[`like ${m}`];
            if(localStorage[`like ${m}`] != 0){
                document.getElementById(m).style.color = 'black';
            }
            document.getElementById(`d${m}`).innerHTML = localStorage[`dislike ${m}`];
            if(localStorage[`dislike ${m}`] != 0){
                document.getElementById(`d${m}`).style.color = 'black';
            }
        }

   
}

function like(like_id){
    for(let k =1; k<= localStorage.clickcount; k++){
        if(like_id == k ){
            let found;
            console.log(localStorage['last_login_member']);
            console.log(like_id);
            let searching_name = `${localStorage['last_login_member']} like ${like_id}`;
            console.log(searching_name);
            for(let v=0; v<localStorage.length; v++){
                if(localStorage.key(v) == searching_name){
                    console.log('if k ander' + localStorage.key(v));
                    found = 1; 
                }else{
                    continue;
                }
            }
            if(found == 1){
                alert('you liked it already');
            }else{
                localStorage.setItem(searching_name,searching_name);
                document.getElementById(like_id).style.color = 'black';
                localStorage[`like ${k}`,  localStorage[`like ${k}`] = Number(localStorage[`like ${k}`]) + 1];
                document.getElementById(like_id).innerHTML = localStorage[`like ${k}`];
            }
        }
    }
}

function dislike(dislike_id){
    for(let z =1; z<= localStorage.clickcount; z++){
        if(dislike_id == `d${z}` ){
            let found;
            let searching_name = `${localStorage['last_login_member']} like ${dislike_id}`;
            for(let v=0; v<localStorage.length; v++){
                if(localStorage.key(v) == searching_name){
                    found = 1; 
                }else{
                    continue;
                }
            }
            if(found == 1){
                alert('you disliked it already');
            }else{
                localStorage.setItem(searching_name,searching_name);
                document.getElementById(dislike_id).style.color = 'black';
                localStorage[`dislike ${z}`,  localStorage[`dislike ${z}`] = Number(localStorage[`dislike ${z}`]) + 1];
                document.getElementById(dislike_id).innerHTML = localStorage[`dislike ${z}`];
            }
        }
    }
}


function exists(){
    let signup_username = ['r',"Rhythm", "Manthan", "Nilay", "Aalind", "Akshu", "Rudra"];
    let signup_password = ['r','123','123','123','123','123','123'];
    let log_usr = document.getElementById("log-usr").value;
    let log_psw = document.getElementById("log-psw").value;
    

        if(signup_username.indexOf(log_usr) > -1 && signup_password.indexOf(log_psw) > -1 ){ //that was blunder!  ---> arrayname.indexOf('string to be searched in array') ---> it checks if string exists or not if yes then retuen 0 else -1  
            alert('found');
            member = log_usr;
            return(true);
        }else{
            alert('not found');
            return(false);
        }
}

function login(){
        //if login's username and password matches then login
        if(exists() === true ){
            //change div with login member information
            document.getElementById('modal-wrapper').style.display='none';
            document.getElementById('fetch-username-after-login').innerHTML = member;
            document.getElementById("message-box-comments").innerHTML = "";
            // enter message in message box //
            document.getElementById('message-box-popup').style.display='block'
        }else{
            document.getElementById('modal-wrapper').style.display='none';
            document.getElementById('modal-wrapper-2').style.display='block';
            //member not found, redirect to signup
            // redirect to ----> signup page
        }
    }

function signup(){ 

    sessionStorage.setItem("name", JSON.stringify(signup_username));
    var retrievedname = sessionStorage.getItem("name");
    var retrievedname = JSON.parse(retrievedname);
    
    sessionStorage.setItem("psw", JSON.stringify(signup_password));
    var retrievedpsw = sessionStorage.getItem("psw");
    var retrievedpsw = JSON.parse(retrievedpsw);

    alert(retrievedname.length);
}

function Add_comment(){

    /////********************************** Storing add btn clicks ****************************////////
    store_btn_click();
    /////////********************************************************************/////////////////
    comment_message = document.getElementById("message-box-comments").value;
 
    document.getElementById('message-box-popup').style.display='none';
    console.log(comment_message);

    /////********************************** clone sample div  ****************************////////
    
    let clone =  document.getElementsByClassName("comment-box-class")[0];
    clone = clone.outerHTML;
   
    // comment_boxes.appendChild(clone);
    var c1 = document.getElementById('comment-boxes');
    c1.insertAdjacentHTML('beforeend', `${clone}`);

    /////********************************** changing comment-username-after-login  ****************************////////
    let comment_name_class = document.getElementsByClassName("comment-name-class")[localStorage.clickcount]
    comment_name_class.innerHTML = member;


    /////********************************** changing comment-message-after-login  ****************************////////
    let comment_message_class = document.getElementsByClassName("row2")[localStorage.clickcount]
    comment_message_class.innerHTML = comment_message;

    /////********************************** create variables for like and dislike  ****************************////////
    document.getElementsByClassName('fetch-like-count')[localStorage.clickcount].id = localStorage.clickcount;
    document.getElementsByClassName('fetch-dislike-count')[localStorage.clickcount].id = 'd' + localStorage.clickcount;


    /////********************************** saving member name in localStorage  ****************************////////
    last_login_member(member);


    /////********************************** saving the shit differently  ****************************////////
    d = document.getElementsByClassName("comment-box-class")[localStorage.clickcount];
    
    localStorage.setItem(`div ${localStorage.clickcount}`, `${d.outerHTML}`);


    /////********************************** like and dislike ****************************////////
    localStorage.setItem(`like ${localStorage.clickcount}`, 0);
    localStorage.setItem(`dislike ${localStorage.clickcount}`, 0);

    
    /////********************************** reload page  ****************************////////    
    location.reload();

}




</script>

</body>

</html>