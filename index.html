<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Comment-Widget</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css"/>
    <script src="jquery.js"></script>
    <!-- <script src="main.js" ></script>  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>

<!----------------------------------------- Heading --------------------------------->

    <header class="header">
    <div style="margin: 0 0 0 1em" class="top-heading"><h3>Comments</h3><img style="vertical-align:bottom;min-height:28px;max-height:28px;min-width:28px;max-width:28px;" src="src/img/chat.svg" alt="comment-img"></div>
    <div style=" width:auto;background-color: rgba(192, 171, 171, 0.2);box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);" class="login-div">
        <img style="background-color:white;border-radius:50%;" class="img" src="https://robohash.org/0" alt="photo">
        <p style="margin-left:15px; margin-right:5px;" id="fetch-username-after-login">guest</p>
    </div>
    </header>
    <hr style="display: block;height: 1px;border: 0;border-top: 1px solid #ccc;margin:1em 0 0 1em;padding: 0px;">

<!----------------------------------------- Sample - comment    --------------------------------->
    <div id="comment-boxes">    
            <div id="comment-box-id" class="comment-box-class">
                <div class="photo">
                <img class="img" src="https://robohash.org/0" alt="photo">
            </div>
            <div class="information">
                <div class="row1">
                    <div class="name"><strong class="comment-name-class" id="fetch-name">Rhythm</strong></div>
                    <div class="time_ago" id="fetch-time">5 min ago</div>
                </div>
                <div class="row2" class="comment-message-class" id="fetch-message">
                    <!-- <textarea id="comments" class="input-field" style="height:100%;width :200%;" name="comment" placeholder="Enter your comment here..."></textarea> -->
                    This has been very useful for my research. Thanks as well! mmkkmkopd sfkopsdkopsdkops dkcvopskvop s kvpodfckv dpflvklpvlp cvklopcvkcov kpxcovk xpcokv; xockv bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
                </div>
                <div class="row3">
                    <div class="reply"><a style="text-decoration: none;" href="">Reply</a></div>
                    <div class="vote">
                        <i class="fa fa-thumbs-up like"></i>
                        <div id="fetch-like"></div>
                        <i class="fa fa-thumbs-down dislike"></i>
                        <div id="fetch-dislike" ></div>
                    </div>
                </div>
            </div>
            </div>
    </div>

<!----------------------------------------- Comment-box for guest --------------------------------->


    <div id="new-message" class="new-message">
        <div class="message-box">
            <textarea id="comments" class="input-field" name="comment" onclick="document.getElementById('modal-wrapper').style.display='block'" placeholder="Enter your comment here..."></textarea>
        </div>
        <div class="submit-button">
            <button onclick="document.getElementById('modal-wrapper').style.display='block'" style="width: 8rem" class="btn">Add a Reply</button>
        </div>
    </div>

<!-----------------------------------------  Login-form  --------------------------------->

<div id="modal-wrapper" class="modal">
      
        <form onsubmit="return false;" class="modal-content animate">
            <div class="imgcontainer">
                <span onclick="document.getElementById('modal-wrapper').style.display='none'" class="close" title="Close PopUp">&times;</span>
                <img src="https://robohash.org/196.png" alt="Avatar" class="avatar">
                <h1 style="text-align:center">Login</h1>
            </div>
    
            <div class="container">
                <input id="log-usr" autocomplete="off" type="text" placeholder="Enter Username" name="uname" required>
                <input id="log-psw" autocomplete="off" type="password" placeholder="Enter Password" name="psw" required>        
                <button type="submit" onclick="login();">Login</button>
                <button onclick="document.getElementById('modal-wrapper-2').style.display='block';document.getElementById('modal-wrapper').style.display='none'" class="button">Sign Up</button>         
            </div>
        </form>
    </div>


<!-----------------------------------------  signup-form  --------------------------------->

    
    <div id="modal-wrapper-2" class="modal">
      
        <form onsubmit="return false;" class="modal-content animate">
            <div class="imgcontainer">
                <span onclick="document.getElementById('modal-wrapper-2').style.display='none'" class="close" title="Close PopUp">&times;</span>
                <img src="https://robohash.org/196.png" alt="Avatar" class="avatar">
                <h1 style="text-align:center">Sign Up here</h1>
            </div>
    
            <div class="container">
                <input id="sign-usr" autocomplete="off" type="text" placeholder="Enter Username" name="uname" required>
                <input id="sign-psw" autocomplete="off" type="password" placeholder="Enter Password" name="psw" required>        
                <button type="submit">Sign Up</button>
            </div>
        </form>
    </div>

<!----------------------------------------- Something after signup -------------------------->


    <!-------------------------------  message box popup open after login ----------------------------->

    <div id="message-box-popup" class="modal">
            <form onsubmit="return false;" class="modal-content animate">
                <div class="imgcontainer" style="margin-top:0px;">
                    <span style="  position: absolute;top: 0px;right: 0px;" onclick="document.getElementById('message-box-popup').style.display='none'" class="close" title="Close PopUp">&times;</span>
                </div>
                <h3>Enter your comment here</h3>
                <div class="container" style="margin-top:20px;">
                    <textarea autocomplete="off" style="width:90%" id="message-box-comments" class="input-field" name="comment" onclick="" placeholder="Enter your comment here..."></textarea>
                    <button onclick="Add_reply();" style="width: 8rem" class="btn">Add a Reply</button>  
                </div>
            </form>
        </div>

    <!-------------------------------  after add reply btn press ----------------------------->

    <div>

    </div>

    <button class="button" onclick="show_div()">clickme</button>
    

<script>    

let member;
let comment_message;
let comment_boxes = document.getElementById("comment-boxes");
var wrapper = document.createElement('div');

// let mylist = [];
localStorage['mylist'] = JSON.stringify(mylist);
// var mylist = JSON.parse(localStorage['mylist']);


function store_btn_click(){
if(typeof(Storage) !== "undefined") {
        if (localStorage.clickcount) {
            localStorage.clickcount = Number(localStorage.clickcount)+1;
        }else{
            localStorage.clickcount = 0;
        }
    }
}



// if(save_div2 != 'undefined'){
//     for(let i = 0; i<localStorage.clickcount; i++){
//         wrapper.innerHTML =  save_div2[i];
//         comment_boxes.appendChild(wrapper);
//     }
// }

function show_div(){
    for(let i = 0; i<localStorage.clickcount; i++){
        console.log(typeof(mylist[i]));
        console.log( mylist[i]);
    wrapper.innerHTML =  mylist[i];
    comment_boxes.appendChild(wrapper);
    }
}


function exists(){
    let signup_username = ['r',"Rhythm", "Manthan", "Nilay", "Aalind", "Akshu", "Rudra"];
    let signup_password = ['r','123','123','123','123','123','123'];
    let log_usr = document.getElementById("log-usr").value;
    let log_psw = document.getElementById("log-psw").value;
    

        if(signup_username.indexOf(log_usr) > -1 && signup_password.indexOf(log_psw) > -1 ){ //that was blunder!  ---> arrayname.indexOf('string to be searched in array') ---> it checks if string exists or not if yes then retuen 0 else -1  
            alert('found');
            member = log_usr;
            return(true);
        }else{
            alert('not found');
            return(false);
        }
}

function login(){
        //if login's username and password matches then login
        if(exists() === true ){
            //change div with login member information
            document.getElementById('modal-wrapper').style.display='none';
            document.getElementById('fetch-username-after-login').innerHTML = member;

            // enter message in message box //
            document.getElementById('message-box-popup').style.display='block'
            
        }else{
            document.getElementById('modal-wrapper').style.display='none';
            document.getElementById('modal-wrapper-2').style.display='block';
            //member not found, redirect to signup
            // redirect to ----> signup page
        }
    }

function signup(){ 

    sessionStorage.setItem("name", JSON.stringify(signup_username));
    var retrievedname = sessionStorage.getItem("name");
    var retrievedname = JSON.parse(retrievedname);
    
    sessionStorage.setItem("psw", JSON.stringify(signup_password));
    var retrievedpsw = sessionStorage.getItem("psw");
    var retrievedpsw = JSON.parse(retrievedpsw);

    alert(retrievedname.length);
}


function Add_reply(){

    /////********************************** Storing add btn clicks ****************************////////
    store_btn_click();
    /////////********************************************************************/////////////////
    comment_message = document.getElementById("message-box-comments").value;
    document.getElementById("message-box-comments").innerHTML = "";
    document.getElementById('message-box-popup').style.display='none';
    console.log(comment_message,localStorage.clickcount);

    /////********************************** changing comment-username-after-login  ****************************////////
    
   
    let clone = comment_boxes.firstElementChild.cloneNode(true);
    comment_boxes.appendChild(clone);

    console.log(localStorage.clickcount);
    /////********************************** changing comment-username-after-login  ****************************////////
    let comment_name_class = document.getElementsByClassName("comment-name-class")[localStorage.clickcount]
    comment_name_class.innerHTML = member;

    /////********************************** changing comment-message-after-login  ****************************////////
    let comment_message_class = document.getElementsByClassName("row2")[localStorage.clickcount]
    comment_message_class.innerHTML = comment_message;

    /////********************************** saving the shit at one place  ****************************////////
    d = document.getElementsByClassName("comment-box-class")[localStorage.clickcount];
    localStorage['mylist'] = JSON.stringify(mylist);
    mylist.push(d.outerHTML);


    wrapper.innerHTML =  mylist[localStorage.clickcount];
    comment_boxes.appendChild(wrapper);

    for(let i = 0; i<localStorage.clickcount; i++){
    console.log(mylist[i]);
    }

    /////********************************** removing clone comment  ****************************////////    
    var comment_node = document.getElementsByClassName("comment-box-class")[localStorage.clickcount];
    comment_node.parentNode.removeChild(comment_node);

}


</script>

</body>

</html>